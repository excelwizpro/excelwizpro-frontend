(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}})();let a="";Office.onReady(async()=>{console.log("ExcelWizPro Loaded"),await l(),i()});async function l(){try{await Excel.run(async t=>{const n=t.workbook.worksheets;n.load("items/name"),await t.sync();const o=document.getElementById("sheetSelect");o.innerHTML="",n.items.forEach(c=>{const e=document.createElement("option");e.value=c.name,e.textContent=c.name,o.appendChild(e)})})}catch(t){console.error("Sheet load error:",t)}}function i(){const t=document.getElementById("generateBtn"),n=document.getElementById("clearBtn"),o=document.getElementById("insertBtn");t.addEventListener("click",u),n.addEventListener("click",d),o.addEventListener("click",m)}async function u(){const t=document.getElementById("query").value.trim(),n=document.getElementById("output"),o=document.getElementById("sheetSelect").value;if(!t){n.textContent="Please enter a request.";return}n.textContent="⏳ Generating formula...";try{a=(await(await fetch("https://excelwizpro-backend.onrender.com/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,mainSheet:o})})).json()).formula||'=ERROR("No formula returned")',n.textContent=a}catch(c){n.textContent="❌ Error generating formula.",console.error(c)}}function d(){document.getElementById("query").value="",document.getElementById("output").textContent="",a=""}async function m(){if(!a){alert("⚠️ Generate a formula first.");return}try{await Excel.run(async t=>{const n=t.workbook.getSelectedRange();n.load("address"),await t.sync(),n.formulas=[[a]],await t.sync()}),alert("Formula inserted!")}catch(t){console.error("Insert error:",t),alert("⚠️ Select a single cell first.")}}
