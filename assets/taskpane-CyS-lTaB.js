(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();let c="";Office.onReady(async()=>{console.log("ExcelWizPro ready."),await i(),l()});async function i(){try{await Excel.run(async r=>{const t=r.workbook.worksheets;t.load("items/name"),await r.sync();const a=document.getElementById("sheetSelect");a.innerHTML="",t.items.forEach(o=>{const e=document.createElement("option");e.value=o.name,e.textContent=o.name,a.appendChild(e)})})}catch(r){console.error("Sheet load error:",r)}}function l(){document.getElementById("generateBtn").addEventListener("click",u),document.getElementById("clearBtn").addEventListener("click",d),document.getElementById("insertBtn").addEventListener("click",m)}async function u(){const r=document.getElementById("query").value.trim(),t=document.getElementById("output"),a=document.getElementById("sheetSelect").value;if(!r){t.textContent="⚠️ Please enter a request.";return}t.textContent="⏳ Generating...";try{const e=await(await fetch("https://excelwizpro-backend.onrender.com/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:r,mainSheet:a})})).json();if(e.error){t.textContent="❌ "+e.error,c="";return}if(!e.formula){t.textContent="❌ No formula returned.",c="";return}c=e.formula,t.textContent=c}catch(o){t.textContent="❌ Backend is unreachable.",console.error(o)}}function d(){document.getElementById("query").value="",document.getElementById("output").textContent="",c=""}async function m(){if(!c){alert("⚠️ Generate a formula first.");return}try{await Excel.run(async r=>{const t=r.workbook.getSelectedRange();t.formulas=[[c]],await r.sync()}),alert("Formula inserted!")}catch(r){console.error("Insert error:",r),alert("⚠️ Select a single cell first.")}}
